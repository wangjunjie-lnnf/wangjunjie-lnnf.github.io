---
layout: post
title:  "FPGA"
date:   2024-02-02 22:22:07 +0000
categories: jekyll
tags: hardware
---

# FPGA

> An FPGA is a programmable logic device, which is a type of integrated circuits that can be used to implement any digital circuit. The name of FPGA originates from the fact that a user can use a `GATE ARRAY` that is `PROGRAMMABLE` on the `FIELD` of any workplace. 

> FPGA自身就是一个集成电路，支持可编程以实现其他电路。

> The basic part of an FPGA is roughly divided into three parts. The first one consists of the logic elements (the logic block: LB) that realize logic circuits. The second is the input/output elements (the input/output block, IOB) which input and output signals to and from outside. The third is the wiring elements (the switch block, SB, and the connection block, CB) connecting LBs and IOBs. Other than that, there are a clock network, a configuration/scan chain, and a test circuit. Commercial FPGAs also contain circuits of specific functions such as processors, block memories, multipliers.

![fpga-overview](/assets/images/2024-02-02/fpga-overview.png)

> 如上图，典型的岛式FPGA主要由3部分组成：I/O block、Logic block、Switch block。

* **Logic Element**: The major program logic implementation schemes is the lookup table (LUT), it consists of a programmable part that can be used to realize any logic circuit, a circuit that holds logic values such as flip-flop (FF) and selectors.

* **Input/Output Element**: It is a block that connects I/O pins and internal wiring elements. It also has some control circuits such as pull-up, pull-down, input/output directions, slew rate, open drain. In addition, it contains a circuit for holding values such as flip-flops. In commercial FPGAs, several standards are supported, such as LVTTL, PCI, PCIe, and SSTL which are single-ended standard I/Os and LVDS of differential standard I/O.

* **Wiring Element**: It consists of wiring channels, connection blocks (CB), and switch blocks (SB) at the connection between logical blocks and between logical blocks and I/O blocks. Besides the island style arranged in a lattice pattern, there are wiring channels of hierarchical structures, and those constituting H-trees. Each switch is programmable, and it is possible to form any wiring route by using the built-in wiring resources.

* **Other Elements**: The logical functions and connection relations of all logical blocks, I/O blocks, switch blocks, and connection blocks are determined by the configuration memory values. The configuration chain is a path to sequentially write the configuration data bits to all configuration memory modules. Basically, the configuration data are serially transferred, and both set and read back are possible. Besides the configuration chain, there are other device-scale networks such as the scan path and the clock network. Others include circuits that support LSI testing, embedded circuits for dedicated functions such as embedded processors, block memories, and multipliers.

> 如果把FPGA比作一个商场，`Logic Element`就像是一个个排列整齐的商铺，可以卖奶茶，可以卖炸鸡，可以做各种生意，`Logic Element`一般是一个查找表结构，可以实现各种布尔方程；`Input/Output Element`就像商场四面八方的出入口；`Wiring Element`就是商场内的道路，`switch blocks`是主干道，`connection blocks`是每个商铺自己的出入口；`Other Elements`好比商场内的基础设施，公厕、导航地图、消防设施等。

> The circuit on the FPGA is controlled by a programmable switch. This programmable switch can be made using various semiconductor technologies. Among these technologies, the flash memory is widely used inmodern FPGAs.

> FPGA上的电路包含很多可编程的开关，通过设置这些开关以实现特定的电路。通常使用硬件描述语言verilog等描述电路，然后编译为bitstream上传到FPGA上的flash存储，然后FPGA加载flash存储中的配置信息设置各个开关以实现指定功能。


## 逻辑电路表示

### 实现投票电路

![vote-gate](/assets/images/2024-02-02/vote-gate.png)

> 上图是一个投票电路的结构，有三个输入按钮，按下任意两个则灯亮。

![vote-kmap](/assets/images/2024-02-02/vote-kmap.png)

> 上图是通过kmap简化之后的布尔等式：`M = AB + AC + BC`。

![vote-fpga-mapping](/assets/images/2024-02-02/vote-fpga-mapping.png)

> 把此投票电路映射到FPGA上的资源：3个按钮对应输入端口；布尔等式对应logic block；输出信号对应到输出端口。

![vote-fpga-implement](/assets/images/2024-02-02/vote-fpga-implement.png)

> 上图表示投票电路在FPGA上的实现，黑色原点表示打开的开关，输入信号从输入端口经过`connection block`成为`logic block`的输入，经过`logic block`计算后产生的输出信号又经过`connection block`和`switch block`连接到输出端口。


### 使用PLA实现布尔等式

![pla-overview](/assets/images/2024-02-02/pla-overview.png)

> In the PLA (programmable logic array), an AND array and an OR array are connected and each has a programmable connection as configuration. In the product term system, in order to realize a desired circuit with fewer circuit resources, it is necessary to express the logical function in a minimum sum-of-products (SoP) form, so the simplification of the logic is very important in the design. The logic function expressed in the sum-of-products form is decomposed into the logical product term and the logical sum term which are, then, implemented in the AND array and the OR array, respectively. 

> 布尔等式简化为`sum-of-products`形式后，由`AND数组`和`OR数组`实现。

![pla-structure](/assets/images/2024-02-02/pla-structure.png)

> Within the AND array, the literal of the input signal and the input of each AND gate are connected by a programmable switch. In the OR array, the output of the AND gate and the input of the OR gate are also connected by a programmable switch. In general, in an AND array, k logical product terms of literals with up to n inputs can be programmed. In addition, the k outputs are inputted to the OR array of the next stage and it is possible to program up to m logical sum terms of the k inputs. 

> 上图可以实现最多4个3变量乘积之和。

![pla-vote](/assets/images/2024-02-02/pla-vote.png)

> 通过设置每个开关的状态可以实现投票电路。


### 使用查找表实现布尔等式

> A lookup table (LUT) is usually a memory table of 1 word 1 bit, and the number of words is determined according to the number of bits of the address. In FPGAs, SRAM is often employed for memory.

![lut-overview](/assets/images/2024-02-02/lut-overview.png)

> In general, the k-input LUT is composed of 2<sup>k</sup> bit SRAM cells and a 2k-input multiplexer. The input of the LUT is the address itself of the memory table, and it outputs 1 bit. The value of the word is determined according to this address. The k-input LUT can realize a logical function of 2 powered by 2k.

> 一个有k个输入的LUT需要2<sup>k</sup>-bit存储配置。

![lut-vote](/assets/images/2024-02-02/lut-vote.png)

> 把投票电路的真值表映射到LUT

![lut-structure](/assets/images/2024-02-02/lut-structure.png)

> 上图(a)表示一个bit的存储结构，上图(b)表示一个2输入的LUT的物理结构。


## FPGA结构

![fpga-detail](/assets/images/2024-02-02/fpga-detail.png)


### Logic Block





### Routing Part






### Switch Block







### Connection Block








### I/O Block






## FPGA设计流程





